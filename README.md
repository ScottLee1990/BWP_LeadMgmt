# BWP Lead Management System

這是我依照博威公司的實際使用需求，以Django MTV框架開發的潛在客戶關係管理系統，專注於紀錄潛在客戶名單、狀態及與報價單管理。
首頁提供了一個的儀錶板來追蹤大業績目標，方便業務人員快速掌握工作進度。

##  核心功能

## 數據總覽儀錶板 (main/views.py)

動態時間區間：可依「月度」、「季度」、「年度」篩選儀錶板上的所有統計數據。

業績目標追蹤：設定不同週期的業績目標（新客戶數、報價總額、成交總額），並以百分比顯示達成率。

客戶數據統計：即時顯示週期內的新增客戶數、有報價客戶數、成交客戶數。

報價數據統計：即時顯示週期內的新增報價單數、新增報價總金額、成交報價單數、成交總金額。

重點追蹤列表：單獨列出被標示為「重點追蹤」的客戶與報價單，方便快速存取。

## 潛在客戶管理 (leads/views.py)

完整的客戶 CRUD：提供潛在客戶的新增、檢視、編輯、刪除功能。

多維度篩選與排序：

可依公司名稱、產業、需求產品進行關鍵字搜尋。

可依客戶評級、狀態、業務負責人進行精準過濾。

可依公司名稱、國家、評級、建立時間、最後聯絡時間等多個欄位進行排序。

聯絡人與溝通紀錄：

可在每個客戶底下建立多個聯絡人。

可為每次的客戶溝通（電話、會議等）新增詳細的開發紀錄。

客戶列表會自動計算並顯示最後聯絡時間。

AJAX Modal 操作：新增/編輯/刪除聯絡人與開發紀錄時，使用非同步的 Modal 彈出視窗，無需刷新頁面，提升使用者體驗。

重點客戶標示：可「置頂」重要客戶，方便在儀錶板和列表中快速找到。

資料匯出：可將當前篩選出的客戶列表一鍵匯出成 CSV 檔案。

詳盡的操作日誌：所有對客戶、聯絡人、開發紀錄的 CUD 操作都會被記錄到 Django 的後台日誌中。


## 報價單管理 (lead_enquiries/views.py)

完整的報價單 CRUD：提供報價單主體、品項、追蹤紀錄、附件的完整管理功能。

動態計算總金額：在報價單列表頁，使用資料庫層級的運算 (annotate) 高效計算每張報價單的台幣總金額。

進階篩選與排序：

可依博威單號、客戶單號、客戶名稱、品項名稱進行關鍵字搜尋。

可依報價單狀態、建立者進行過濾。

支援按總金額進行排序。

報價單品項管理：透過 AJAX Modal 彈窗，流暢地為報價單新增、編輯、刪除多個品項。

報價單追蹤系統：記錄報價單的每一次進度更新，並驗證只有建立者才能修改或刪除自己的追蹤紀錄。

附件上傳與管理：可為每張報價單上傳多個附件，並進行刪除。

資料匯出：可將當前篩選出的報價單列表（包含計算後的總金額）匯出成 CSV 檔案。

## 技術特點
高效的資料庫查詢：大量使用 Django ORM 的進階功能，如 annotate, Sum, F, Q, ExpressionWrapper，將複雜的計算（如總金額統計）和關聯查詢直接在資料庫層級完成，大幅提升效能。

非同步前端互動：廣泛採用 AJAX 和 JsonResponse，搭配 render_to_string，實現了 Modal 彈窗表單，讓多數的子項目操作（如新增聯絡人、報價品項）無需重新載入頁面，操作流暢。

關注點分離：透過輔助函式 (e.g., _get_filtered_customers_queryset) 將複雜的查詢與過濾邏輯從 view 主體中抽離，使程式碼更乾淨、更易於維護。

內建操作日誌：深度整合 django.contrib.admin.models.LogEntry，為所有重要的資料變更提供可靠的追蹤紀錄。

## 安全與權限控制：
所有視圖均使用 @login_required 裝飾器，確保只有登入使用者才能存取。

在關鍵操作（如刪除開發紀錄）上增加了操作者身份驗證。

使用 get_object_or_404 來優雅地處理不存在的物件請求。

通用資料匯出：建立了可重用的 CSV 匯出邏輯，並正確處理了 UTF-8 BOM 和檔名編碼問題。